#include <ESP8266WiFi.h>
#include <ESP8266mDNS.h>
#include <WiFiUdp.h>
#include <ESP8266WebServer.h>
#include <WiFiClient.h>
#include <ArduinoJson.h>
#include <EEPROM.h>
#include <DNSServer.h>
#include <string.h>
#include <avr/pgmspace.h>
#include <SoftwareSerial.h>

/**
 * A sketch to open a Wireless Access Point from within printerX's case using
 *    an ESP8266-12E, provide a captive portal, and update a printer's WiFi
 *    access credentials
 *    
 * Matches hardware: ostmoxy pihat version 2.2
 * 
 * Serial receipt code is commented since we are not currently handling any
 *   events based on incoming serial data
 * 
 * @author costmo
 */

/**
 * Global variables
 */
// SSID broadcast prefix for all printerX access points. Will be suffixed with a unique ID generated from the WiFi module's MAC address.
String  ssidPrefix = "printerX-";
// Internal port for web access
int serverPort = 5050;
// User's SSID
String ssid = "";
// IP Address of the Software AP
String softIP  = "";
// Query port for captive portal DNS
const byte DNS_PORT = 53;
// // Flag for serial receiver
//bool receiving = false;
// // Receipt buffer size
//int bufferSize = 512;
// // Incoming serial data buffer
//char buff [512];
// // Current position in the buffer
//int bufferIndex = 0;

// Get third party libraries setup...
// Set pins 3 and 1 (RX and TX) for serial communications with a Raspberry Pi (through an ostmoxy pihat, by design)
SoftwareSerial softSerial( 3, 1 );
// The local access point's IP address
IPAddress ip;
// Run web servers on various ports that may be the targets of requests
ESP8266WebServer server( serverPort );
ESP8266WebServer server_443( 443 );
ESP8266WebServer server_80( 80 );
// A DNS server, which causes all traffic to redirect to a built-in captive portal
DNSServer dnsServer;

// Delay between loop iterations
int tickDuration = 100;
// Counter for current iteration
int currentTick = 0;
// How many ticks before disabling the softAP - currently set to 10 minutes
int timeoutTicks = (10 * 60) * 10;

// This was a valiant effort, but there was not enough memory on the device
// const char commonLogo[] PROGMEM = "<svg xmlns:dc='http://purl.org/dc/elements/1.1/' xmlns:cc='http://creativecommons.org/ns#' xmlns:rdf='http://www.w3.org/1999/02/22-rdf-syntax-ns#' xmlns:svg='http://www.w3.org/2000/svg' xmlns='http://www.w3.org/2000/svg' id='svg8' version='1.1' viewBox='0 0 151.80733 30.649331' height='115.83999' width='573.76001'><defs id='defs2' /><metadata id='metadata5'><rdf:RDF><cc:Work rdf:about=''><dc:format>image/svg+xml</dc:format><dc:type rdf:resource='http://purl.org/dc/dcmitype/StillImage' /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g transform='translate(-32.953472,-126.79438)' style='display:inline' id='layer1'><g id='g211'><path id='path90' d='m 32.953472,142.11905 v -15.32467 h 75.903668 75.90367 v 15.32467 15.32466 H 108.85714 32.953472 Z m 55.44195,11.63194 c 0.387722,-0.0662 0.835397,-0.1749 0.994833,-0.24152 l 0.289886,-0.12112 v -1.19126 -1.19127 l -0.1905,0.0433 c -0.104775,0.0238 -0.36195,0.0822 -0.5715,0.12971 -0.683843,0.15517 -2.401658,0.20557 -2.851804,0.0837 -0.833005,-0.22556 -1.37898,-0.6206 -1.783146,-1.29018 -0.57218,-0.94793 -0.559346,-0.77868 -0.593831,-7.83096 l -0.03115,-6.37007 2.947465,-0.0223 2.947465,-0.0223 0.02349,-1.2065 0.02349,-1.2065 h -2.965658 -2.965658 v -2.33119 -2.3312 l -0.903484,0.024 -0.903484,0.024 -0.631849,2.12773 -0.63185,2.12773 -1.449166,0.63291 -1.449168,0.63291 v 0.75302 0.75303 l 1.4605,0.0232 1.4605,0.0232 0.0011,6.58083 c 10e-4,6.19611 0.01078,6.62785 0.166569,7.38517 0.679116,3.30137 3.391424,4.73186 7.606932,4.01194 z m 45.707688,0.13614 c 2.47548,-0.21914 4.17445,-0.9933 5.7112,-2.60239 1.62123,-1.69755 2.39424,-3.68489 2.61294,-6.71768 0.21852,-3.03027 -0.40125,-5.87692 -1.69469,-7.78381 -1.40477,-2.07102 -3.28306,-3.27186 -5.76742,-3.68727 -1.24021,-0.20738 -3.2721,-0.1334 -4.4021,0.16028 -1.5837,0.41159 -2.63041,0.96386 -3.67408,1.93853 -1.42869,1.33424 -2.28181,2.96229 -2.76325,5.27326 -0.17031,0.81748 -0.19404,1.17456 -0.19412,2.921 -9e-5,1.5942 0.0307,2.14112 0.15482,2.75166 0.79749,3.92252 3.00355,6.50525 6.36073,7.4468 1.23296,0.3458 2.2203,0.42671 3.65597,0.29962 z m -1.91517,-2.62643 c -1.97466,-0.27369 -3.30793,-1.23793 -4.15278,-3.00332 -0.22285,-0.46567 -0.46846,-1.08424 -0.5458,-1.3746 -0.2212,-0.83047 -0.3831,-2.25688 -0.3849,-3.39124 -0.006,-3.86243 1.05873,-6.25197 3.25085,-7.29486 0.97112,-0.462 1.4325,-0.55283 2.80117,-0.55145 1.68598,0.002 2.61814,0.28025 3.68822,1.10216 0.8204,0.63013 1.43835,1.56331 1.8495,2.79295 0.37969,1.13552 0.52489,2.21027 0.52466,3.88337 0,2.17595 -0.2473,3.49338 -0.91416,4.876 -0.69221,1.43517 -1.86776,2.40974 -3.37022,2.794 -0.7524,0.19243 -2.0109,0.26895 -2.74654,0.16699 z m -86.365134,2.49531 c 0.395817,-0.0287 1.15181,-0.1635 1.679984,-0.29948 4.463754,-1.14918 6.797502,-4.97922 6.591952,-10.81841 -0.121776,-3.45938 -1.012446,-5.81801 -2.870147,-7.60061 -1.688269,-1.62002 -3.844229,-2.35025 -6.925789,-2.34579 -2.075267,0.003 -3.469105,0.28944 -4.949128,1.01705 -2.643561,1.29963 -4.2719,3.86089 -4.698454,7.39031 -0.119477,0.98859 -0.122756,3.28543 -0.006,4.19497 0.321039,2.50064 1.099378,4.36442 2.416958,5.78757 1.508546,1.62941 3.495664,2.50613 6.159552,2.71761 0.848151,0.0673 1.146939,0.0624 2.60106,-0.0432 z m -2.328334,-3.64835 c -1.200142,-0.19327 -1.934371,-0.54816 -2.670222,-1.29067 -1.224618,-1.2357 -1.786651,-3.33281 -1.658926,-6.18994 0.107119,-2.39619 0.627216,-3.94233 1.671889,-4.97019 0.903048,-0.88851 1.698637,-1.20742 3.177186,-1.27356 1.991945,-0.0891 3.247065,0.42131 4.222685,1.7172 0.953796,1.2669 1.411997,3.60799 1.223976,6.25366 -0.224617,3.1606 -1.403527,5.01383 -3.564675,5.60362 -0.471425,0.12865 -1.957769,0.2214 -2.401913,0.14988 z m 21.855959,3.69476 c 4.025804,-0.30711 6.384718,-2.26276 6.605736,-5.47646 0.127668,-1.85634 -0.464183,-3.44763 -1.703594,-4.58038 -0.752828,-0.68804 -1.714318,-1.27402 -3.904875,-2.37982 -2.376655,-1.19975 -2.910331,-1.59526 -3.124166,-2.31531 -0.24939,-0.83979 -0.112089,-1.43922 0.461652,-2.01549 0.294631,-0.29593 0.502287,-0.41844 0.896898,-0.52917 1.179874,-0.33105 2.948616,-0.0688 5.100991,0.7563 0.433731,0.16627 0.79809,0.28888 0.809686,0.27247 0.04792,-0.0678 1.311142,-3.17243 1.336966,-3.28584 0.05647,-0.24802 -2.477629,-1.12723 -4.025842,-1.39677 -0.452407,-0.0788 -1.256524,-0.1309 -2.018701,-0.1309 -2.484774,0 -4.194281,0.58111 -5.46157,1.85654 -0.626116,0.63015 -1.015072,1.28457 -1.278698,2.15145 -0.279405,0.91875 -0.299403,2.58325 -0.04144,3.44936 0.372683,1.25131 1.40201,2.56948 2.647167,3.39 0.351909,0.2319 1.535185,0.87558 2.629502,1.43041 2.254519,1.14305 2.833958,1.54767 3.163575,2.20913 0.645156,1.29466 -0.121039,2.62146 -1.678912,2.90733 -0.632119,0.116 -2.038855,0.0582 -2.911715,-0.11972 -0.891619,-0.1817 -2.684706,-0.77241 -3.62431,-1.19398 -0.303833,-0.13632 -0.586972,-0.24786 -0.629198,-0.24786 -0.04378,0 -0.07677,0.86839 -0.07677,2.02044 v 2.02044 l 0.486834,0.21628 c 1.15253,0.51202 2.716369,0.88448 4.14282,0.9867 0.503807,0.0361 0.954113,0.0711 1.00068,0.0777 0.04657,0.007 0.585347,-0.0261 1.197291,-0.0728 z m 29.579044,-6.1757 c 0,-6.54375 0.0388,-7.20452 0.509359,-8.6735 0.68268,-2.13118 2.106488,-3.17575 4.531859,-3.32478 2.081437,-0.1279 3.441987,0.51165 4.143177,1.94756 0.54217,1.11027 0.55227,1.27564 0.55227,9.04147 v 6.93158 h 1.56634 1.56633 l 0.003,-6.1595 c 10e-4,-3.431 0.0387,-6.43718 0.084,-6.78636 0.35252,-2.71579 1.5095,-4.24007 3.63679,-4.7913 0.8537,-0.22122 2.12569,-0.26039 2.96077,-0.0912 1.48883,0.30167 2.24523,0.97534 2.77393,2.47053 l 0.23625,0.66814 0.0243,7.34483 0.0243,7.34484 h 1.56746 1.56745 l -0.0311,-7.51417 c -0.034,-8.20234 -0.0155,-7.87954 -0.5369,-9.37584 -0.84945,-2.43772 -2.96706,-3.68399 -6.25971,-3.68399 -1.64219,0 -2.90271,0.312 -4.16267,1.03034 -0.75603,0.43103 -1.75797,1.33554 -2.14154,1.93329 -0.14931,0.23267 -0.30336,0.42303 -0.34234,0.42303 -0.039,0 -0.19053,-0.22449 -0.33677,-0.49888 -0.50511,-0.94767 -1.31697,-1.7076 -2.36845,-2.21694 -1.69911,-0.82307 -4.44714,-0.90743 -6.34497,-0.1948 -1.163201,0.43678 -2.304216,1.30995 -2.962989,2.26745 -0.151772,0.22059 -0.295379,0.38164 -0.319128,0.35789 -0.03069,-0.0307 -0.513739,-2.52254 -0.531453,-2.74155 -9.42e-4,-0.0116 -0.573212,-0.0212 -1.271712,-0.0212 h -1.27 v 10.11767 10.11767 h 1.566333 1.566334 z m 57.104875,2.06333 c 1.82714,-2.97574 2.38785,-3.82894 2.45533,-3.7361 0.0481,0.0662 1.11617,1.8011 2.37347,3.85539 l 2.286,3.73507 2.52338,0.002 2.52338,0.002 -3.44767,-5.13919 c -1.89621,-2.82655 -3.44681,-5.17923 -3.44578,-5.22817 0.001,-0.0489 1.39778,-2.29129 3.10389,-4.98301 1.70612,-2.69172 3.14171,-4.9682 3.19023,-5.05883 0.0864,-0.16146 0.0403,-0.1648 -2.26822,-0.1648 h -2.35641 l -1.60376,2.7305 c -0.88206,1.50177 -1.85791,3.16335 -2.16855,3.69239 l -0.56479,0.9619 -2.13494,-3.58657 c -1.17421,-1.9726 -2.17976,-3.63479 -2.23455,-3.69374 -0.0768,-0.0826 -0.64648,-0.10202 -2.48753,-0.0847 l -2.38791,0.0225 2.98618,4.65667 c 1.64241,2.56116 3.07361,4.79817 3.18047,4.97112 l 0.19428,0.31445 -3.33347,5.18888 c -1.83341,2.85388 -3.36192,5.2365 -3.39669,5.29471 -0.05,0.0837 0.43016,0.10557 2.29129,0.10455 l 2.3545,-0.001 2.36787,-3.85642 z m 24.7678,-0.14346 v -4.00245 l 3.35477,-6.17871 c 1.84512,-3.3983 3.3732,-6.22634 3.39573,-6.28455 0.0322,-0.0831 -0.46489,-0.10552 -2.31761,-0.10436 l -2.35856,0.001 -2.11667,4.1879 c -1.16416,2.30335 -2.13589,4.18864 -2.1594,4.18953 -0.0235,8.9e-4 -0.98547,-1.88433 -2.13772,-4.18938 l -2.09498,-4.191 h -2.37079 c -1.30392,0 -2.37077,0.0158 -2.37077,0.0351 0,0.0193 1.524,2.87343 3.38666,6.34246 l 3.38667,6.30732 v 3.94455 3.94455 h 2.20133 2.20134 z' style='fill:#fefefe;stroke-width:0.0846667' /><path id='path88' d='m 86.023599,153.91454 c 0.06112,-0.0245 0.134145,-0.0215 0.162278,0.007 0.02813,0.0281 -0.02187,0.0481 -0.111125,0.0445 -0.09863,-0.004 -0.118694,-0.0241 -0.05115,-0.0511 z m 46.566671,0 c 0.0611,-0.0245 0.13414,-0.0215 0.16228,0.007 0.0281,0.0281 -0.0219,0.0481 -0.11113,0.0445 -0.0986,-0.004 -0.11869,-0.0241 -0.0512,-0.0511 z m 0.762,0 c 0.0611,-0.0245 0.13414,-0.0215 0.16228,0.007 0.0281,0.0281 -0.0219,0.0481 -0.11113,0.0445 -0.0986,-0.004 -0.11869,-0.0241 -0.0512,-0.0511 z m -89.201631,-0.0852 c 0.08149,-0.0213 0.214842,-0.0213 0.296334,0 0.08149,0.0213 0.01482,0.0387 -0.148167,0.0387 -0.162984,0 -0.229659,-0.0174 -0.148167,-0.0387 z m 20.023668,-0.001 c 0.104775,-0.0202 0.276225,-0.0202 0.381,0 0.104775,0.0202 0.01905,0.0367 -0.1905,0.0367 -0.20955,0 -0.295275,-0.0165 -0.1905,-0.0367 z m -21.33071,-0.0828 c 0.06112,-0.0245 0.134144,-0.0215 0.162279,0.007 0.02813,0.0281 -0.02187,0.0481 -0.111126,0.0445 -0.09863,-0.004 -0.118694,-0.0241 -0.05115,-0.0511 z m 2.878667,0 c 0.06112,-0.0245 0.134144,-0.0215 0.162278,0.007 0.02813,0.0281 -0.02187,0.0481 -0.111125,0.0445 -0.09863,-0.004 -0.118694,-0.0241 -0.05115,-0.0511 z m 17.012709,0.002 c 0.05821,-0.0235 0.153459,-0.0235 0.211667,0 0.05821,0.0235 0.01058,0.0427 -0.105833,0.0427 -0.116417,0 -0.164042,-0.0192 -0.105834,-0.0427 z m 3.053292,-0.002 c 0.06112,-0.0245 0.134144,-0.0215 0.162278,0.007 0.02813,0.0281 -0.02187,0.0481 -0.111125,0.0445 -0.09863,-0.004 -0.118694,-0.0241 -0.05115,-0.0511 z m -19.388667,-0.0847 c 0.06112,-0.0245 0.134143,-0.0214 0.162278,0.007 0.02813,0.0281 -0.02187,0.0481 -0.111125,0.0445 -0.09863,-0.004 -0.118695,-0.0241 -0.05115,-0.0512 z m 15.663334,0 c 0.06112,-0.0245 0.134144,-0.0214 0.162278,0.007 0.02813,0.0281 -0.02187,0.0481 -0.111125,0.0445 -0.09863,-0.004 -0.118695,-0.0241 -0.05115,-0.0512 z m 110.375638,-4.04849 c -2e-5,-2.18864 0.0109,-3.09614 0.0243,-2.01667 0.0134,1.07947 0.0134,2.87017 3e-5,3.97934 -0.0134,1.10916 -0.0243,0.22596 -0.0243,-1.96267 z m -113.87915,0.97366 c 0,-1.14088 0.01198,-1.60761 0.02663,-1.03716 0.01465,0.57044 0.01465,1.50389 0,2.07433 -0.01465,0.57044 -0.02663,0.10372 -0.02663,-1.03717 z m 11.605054,1.43934 c 0.08428,-0.0931 0.172295,-0.16934 0.195578,-0.16934 0.02328,0 -0.02663,0.0762 -0.110912,0.16934 -0.08428,0.0931 -0.172295,0.16933 -0.195578,0.16933 -0.02328,0 0.02663,-0.0762 0.110912,-0.16933 z m -32.480468,-0.3175 c -0.105315,-0.13429 -0.10232,-0.13729 0.03197,-0.032 0.08149,0.0639 0.148167,0.13058 0.148167,0.14817 0,0.0697 -0.06953,0.0248 -0.180133,-0.1162 z m 32.903801,-0.10584 c 0.08429,-0.0931 0.172295,-0.16933 0.195578,-0.16933 0.02328,0 -0.02663,0.0762 -0.110911,0.16933 -0.08428,0.0931 -0.172295,0.16934 -0.195579,0.16934 -0.02328,0 0.02663,-0.0762 0.110912,-0.16934 z m -19.304001,-0.254 c 0.181884,-0.18626 0.34975,-0.33866 0.373033,-0.33866 0.02328,0 -0.106482,0.1524 -0.288366,0.33866 -0.181885,0.18627 -0.34975,0.33867 -0.373033,0.33867 -0.02328,0 0.106482,-0.1524 0.288366,-0.33867 z m -14.446467,-0.48713 c -0.105314,-0.13429 -0.10232,-0.13728 0.03197,-0.032 0.141033,0.11061 0.185883,0.18014 0.1162,0.18014 -0.01758,0 -0.08426,-0.0667 -0.148167,-0.14817 z m 27.337955,-0.67372 c 0.105318,-0.0203 0.257718,-0.0195 0.338667,0.002 0.08095,0.0212 -0.0052,0.0378 -0.191488,0.0368 -0.186266,-9.4e-4 -0.252497,-0.0183 -0.147179,-0.0385 z m 0.762,0 c 0.105318,-0.0203 0.257718,-0.0195 0.338667,0.002 0.08095,0.0212 -0.0052,0.0378 -0.191488,0.0368 -0.186266,-9.4e-4 -0.252497,-0.0183 -0.147179,-0.0385 z m -21.416363,-0.0826 c 0.06112,-0.0245 0.134143,-0.0215 0.162278,0.007 0.02813,0.0281 -0.02187,0.0481 -0.111125,0.0445 -0.09863,-0.004 -0.118694,-0.0241 -0.05115,-0.0511 z m 1.524,0 c 0.06112,-0.0245 0.134143,-0.0215 0.162278,0.007 0.02813,0.0281 -0.02187,0.0481 -0.111125,0.0445 -0.09863,-0.004 -0.118694,-0.0241 -0.05115,-0.0511 z m -4.267836,-1.23333 -0.161289,-0.1905 0.1905,0.16129 c 0.179023,0.15157 0.229043,0.21971 0.161289,0.21971 -0.01607,0 -0.101791,-0.0857 -0.1905,-0.1905 z m 31.136413,-0.40216 c 0,-0.11642 0.01922,-0.16405 0.04271,-0.10584 0.02349,0.0582 0.02349,0.15346 0,0.21167 -0.02349,0.0582 -0.04271,0.0106 -0.04271,-0.10583 z m 0.0031,-1.143 c 0.0017,-0.1397 0.0207,-0.1866 0.04217,-0.10423 0.02147,0.0824 0.02005,0.19668 -0.0031,0.254 -0.02319,0.0573 -0.04076,-0.0101 -0.03903,-0.14977 z m -32.69116,-2.03906 c 0.0041,-0.0986 0.02412,-0.11869 0.05115,-0.0512 0.02446,0.0611 0.02145,0.13414 -0.0067,0.16228 -0.02813,0.0281 -0.04815,-0.0219 -0.04447,-0.11113 z m 14.732001,0 c 0.0041,-0.0986 0.02413,-0.11869 0.05115,-0.0512 0.02446,0.0611 0.02145,0.13414 -0.0067,0.16228 -0.02814,0.0281 -0.04815,-0.0219 -0.04447,-0.11113 z m -19.388668,-0.508 c 0.0041,-0.0986 0.02413,-0.11869 0.05115,-0.0511 0.02446,0.0611 0.02145,0.13414 -0.0067,0.16228 -0.02813,0.0281 -0.04815,-0.0219 -0.04447,-0.11113 z m 4.578684,-0.20461 c 0,-0.11642 0.01922,-0.16404 0.04271,-0.10583 0.02349,0.0582 0.02349,0.15345 0,0.21166 -0.02349,0.0582 -0.04271,0.0106 -0.04271,-0.10583 z m 14.911026,-0.254 c 0,-0.20955 0.01651,-0.29528 0.03669,-0.1905 0.02018,0.10477 0.02018,0.27622 0,0.381 -0.02018,0.10477 -0.03669,0.019 -0.03669,-0.1905 z m -4.572,-0.33867 c 0,-0.20955 0.01651,-0.29527 0.03669,-0.1905 0.02018,0.10478 0.02018,0.27623 0,0.381 -0.02018,0.10478 -0.03669,0.019 -0.03669,-0.1905 z m 89.736979,-0.254 c 0,-0.11641 0.0192,-0.16404 0.0427,-0.10583 0.0235,0.0582 0.0235,0.15346 0,0.21167 -0.0235,0.0582 -0.0427,0.0106 -0.0427,-0.10584 z m 3.21065,0.0353 c 0.004,-0.0986 0.0241,-0.11869 0.0512,-0.0512 0.0245,0.0611 0.0215,0.13414 -0.007,0.16228 -0.0281,0.0281 -0.0481,-0.0219 -0.0445,-0.11113 z m -72.407488,-0.18344 c -0.105315,-0.13429 -0.10232,-0.13729 0.03197,-0.032 0.141034,0.11061 0.185884,0.18013 0.1162,0.18013 -0.01758,0 -0.08426,-0.0667 -0.148166,-0.14816 z m 69.196838,-0.4445 c 0,-0.11642 0.0192,-0.16405 0.0427,-0.10584 0.0235,0.0582 0.0235,0.15346 0,0.21167 -0.0235,0.0582 -0.0427,0.0106 -0.0427,-0.10583 z m 3.21065,-0.0494 c 0.004,-0.0986 0.0241,-0.1187 0.0512,-0.0512 0.0245,0.0611 0.0215,0.13415 -0.007,0.16228 -0.0281,0.0281 -0.0481,-0.0219 -0.0445,-0.11112 z m -92.947587,-0.54331 c 0,-0.20955 0.01651,-0.29528 0.03669,-0.1905 0.02018,0.10477 0.02018,0.27622 0,0.381 -0.02018,0.10477 -0.03669,0.0191 -0.03669,-0.1905 z m 4.570291,-0.381 c 9.4e-4,-0.18627 0.01828,-0.2525 0.03853,-0.14718 0.02025,0.10532 0.01948,0.25772 -0.0017,0.33867 -0.02119,0.081 -0.03776,-0.005 -0.03682,-0.19149 z m -14.909317,-0.21167 c 0,-0.11641 0.01922,-0.16404 0.04271,-0.10583 0.02349,0.0582 0.02349,0.15346 0,0.21167 -0.02349,0.0582 -0.04271,0.0106 -0.04271,-0.10584 z m -4.578684,-0.30339 c 0.0041,-0.0986 0.02413,-0.11869 0.05115,-0.0512 0.02446,0.0611 0.02145,0.13414 -0.0067,0.16228 -0.02813,0.0281 -0.04815,-0.0219 -0.04447,-0.11113 z m 14.816667,-0.254 c 0.0041,-0.0986 0.02413,-0.11869 0.05115,-0.0512 0.02446,0.0611 0.02145,0.13414 -0.0067,0.16228 -0.02813,0.0281 -0.04814,-0.0219 -0.04447,-0.11113 z m 4.578684,-0.20461 c 0,-0.11641 0.01922,-0.16404 0.0427,-0.10583 0.02349,0.0582 0.02349,0.15346 0,0.21167 -0.02349,0.0582 -0.0427,0.0106 -0.0427,-0.10584 z m 9.627833,-1.41816 c -0.105315,-0.13429 -0.10232,-0.13728 0.03197,-0.032 0.08149,0.0639 0.148167,0.13058 0.148167,0.14817 0,0.0697 -0.06953,0.0248 -0.180133,-0.1162 z m -4.786176,-1.24884 c 3.39e-4,-0.37253 0.01519,-0.5144 0.03308,-0.31526 0.01788,0.19914 0.01763,0.50394 -5.92e-4,0.67733 -0.01819,0.1734 -0.03283,0.0105 -0.03252,-0.36207 z m 4.29566,0.33161 c 0.0041,-0.0986 0.02412,-0.11869 0.05115,-0.0511 0.02446,0.0611 0.02145,0.13414 -0.0067,0.16228 -0.02813,0.0281 -0.04815,-0.0219 -0.04447,-0.11113 z m -15.088152,-1.03011 c -0.105314,-0.13428 -0.102319,-0.13728 0.03197,-0.032 0.08149,0.0639 0.148167,0.13058 0.148167,0.14816 0,0.0697 -0.06953,0.0248 -0.180134,-0.1162 z m -7.058867,-0.35983 c 0.08428,-0.0931 0.172295,-0.16933 0.195578,-0.16933 0.02328,0 -0.02663,0.0762 -0.110911,0.16933 -0.08428,0.0931 -0.172295,0.16933 -0.195578,0.16933 -0.02328,0 0.02663,-0.0762 0.110911,-0.16933 z m 6.550867,-0.14817 c -0.105314,-0.13428 -0.102319,-0.13728 0.03197,-0.032 0.141033,0.1106 0.185884,0.18013 0.1162,0.18013 -0.01758,0 -0.08426,-0.0667 -0.148167,-0.14817 z m -4.323075,-0.92567 c 0.06112,-0.0245 0.134143,-0.0214 0.162278,0.007 0.02813,0.0281 -0.02187,0.0482 -0.111125,0.0445 -0.09863,-0.004 -0.118694,-0.0241 -0.05115,-0.0512 z m 2.201334,0 c 0.06112,-0.0245 0.134143,-0.0214 0.162278,0.007 0.02813,0.0281 -0.02187,0.0482 -0.111125,0.0445 -0.09863,-0.004 -0.118695,-0.0241 -0.05115,-0.0512 z m 21.076709,0.002 c 0.05821,-0.0235 0.153458,-0.0235 0.211666,0 0.05821,0.0235 0.01058,0.0427 -0.105833,0.0427 -0.116417,0 -0.164042,-0.0192 -0.105833,-0.0427 z m -22.438556,-0.0897 c 0.150303,-0.0187 0.417003,-0.019 0.592667,-6.7e-4 0.175663,0.0183 0.05269,0.0336 -0.273279,0.034 -0.325967,3.4e-4 -0.469692,-0.0146 -0.319388,-0.0333 z m 33.665776,-1.33589 c -2.54e-4,-0.4191 0.01406,-0.60122 0.03181,-0.40472 0.01776,0.1965 0.01797,0.5394 5.08e-4,0.762 -0.01754,0.2226 -0.03206,0.0618 -0.03232,-0.35728 z m 61.856733,0.40217 -0.29178,-0.3175 0.3175,0.29178 c 0.29552,0.27157 0.35643,0.34322 0.29178,0.34322 -0.0142,0 -0.15703,-0.14288 -0.3175,-0.3175 z M 37.144472,135.26105 c 0.08429,-0.0931 0.172295,-0.16934 0.195578,-0.16934 0.02328,0 -0.02663,0.0762 -0.110911,0.16934 -0.08428,0.0931 -0.172295,0.16933 -0.195578,0.16933 -0.02328,0 0.02663,-0.0762 0.110911,-0.16933 z m 23.114001,-0.67734 c 0.08429,-0.0931 0.172295,-0.16933 0.195579,-0.16933 0.02328,0 -0.02663,0.0762 -0.110912,0.16933 -0.08429,0.0931 -0.172295,0.16934 -0.195578,0.16934 -0.02328,0 0.02663,-0.0762 0.110911,-0.16934 z m 7.392459,-1.75117 c 0.06112,-0.0245 0.134144,-0.0214 0.162278,0.007 0.02813,0.0281 -0.02187,0.0481 -0.111125,0.0445 -0.09863,-0.004 -0.118694,-0.0241 -0.05115,-0.0512 z m -24.976668,-0.0847 c 0.06112,-0.0245 0.134143,-0.0215 0.162278,0.007 0.02813,0.0281 -0.02187,0.0482 -0.111125,0.0445 -0.09863,-0.004 -0.118694,-0.0241 -0.05115,-0.0512 z m 3.217334,0 c 0.06112,-0.0245 0.134143,-0.0215 0.162278,0.007 0.02813,0.0281 -0.02187,0.0482 -0.111125,0.0445 -0.09863,-0.004 -0.118695,-0.0241 -0.05115,-0.0512 z m 18.536709,0.002 c 0.05821,-0.0235 0.153458,-0.0235 0.211666,0 0.05821,0.0235 0.01058,0.0427 -0.105833,0.0427 -0.116417,0 -0.164042,-0.0192 -0.105833,-0.0427 z m 2.54,0 c 0.05821,-0.0235 0.153458,-0.0235 0.211667,0 0.05821,0.0235 0.01058,0.0427 -0.105834,0.0427 -0.116417,0 -0.164042,-0.0192 -0.105833,-0.0427 z m -22.984447,-0.0909 c 0.222597,-0.0175 0.565497,-0.0173 0.762,4.6e-4 0.196504,0.0178 0.01438,0.0321 -0.404721,0.0318 -0.4191,-2.5e-4 -0.579875,-0.0148 -0.357279,-0.0323 z' style='fill:#fdd19e;stroke-width:0.0846667' /><path id='path86' d='m 63.078932,153.74521 c 0.06112,-0.0245 0.134144,-0.0215 0.162278,0.007 0.02813,0.0281 -0.02187,0.0481 -0.111125,0.0445 -0.09863,-0.004 -0.118694,-0.0241 -0.05115,-0.0511 z m 2.455333,0 c 0.06112,-0.0245 0.134144,-0.0215 0.162278,0.007 0.02813,0.0281 -0.02187,0.0481 -0.111125,0.0445 -0.09863,-0.004 -0.118694,-0.0241 -0.05115,-0.0511 z m 111.222365,-4.21783 c 2e-5,-2.2352 0.011,-3.13744 0.0243,-2.00498 0.0133,1.13246 0.0133,2.96126 -3e-5,4.064 -0.0134,1.10274 -0.0243,0.17618 -0.0243,-2.05902 z m -139.489716,1.75683 -0.291775,-0.3175 0.3175,0.29178 c 0.174625,0.16047 0.3175,0.30335 0.3175,0.3175 0,0.0647 -0.07165,0.004 -0.343225,-0.29178 z m 29.807226,-1.75683 c 0.109368,-0.11642 0.217901,-0.21167 0.241184,-0.21167 0.02328,0 -0.04715,0.0953 -0.156517,0.21167 -0.109368,0.11642 -0.217901,0.21167 -0.241184,0.21167 -0.02328,0 0.04715,-0.0952 0.156517,-0.21167 z m -19.304001,-0.59267 c 0.109368,-0.11641 0.217901,-0.21166 0.241184,-0.21166 0.02328,0 -0.04715,0.0952 -0.156517,0.21166 -0.109368,0.11642 -0.217901,0.21167 -0.241184,0.21167 -0.02328,0 0.04715,-0.0952 0.156517,-0.21167 z m 24.154217,-1.016 c 6.77e-4,-0.23283 0.01708,-0.31803 0.03654,-0.18933 0.01946,0.12869 0.01894,0.31919 -0.0012,0.42333 -0.0201,0.10413 -0.03602,-0.001 -0.03538,-0.234 z m -4.244181,0.127 c 0,-0.11641 0.01922,-0.16404 0.0427,-0.10583 0.02349,0.0582 0.02349,0.15346 0,0.21167 -0.02349,0.0582 -0.0427,0.0106 -0.0427,-0.10584 z m 86.652545,-2.21682 c 0.0245,-0.0396 0.0799,-0.05 0.12328,-0.0232 0.11077,0.0685 0.0983,0.0952 -0.0445,0.0952 -0.0678,0 -0.10327,-0.0324 -0.0788,-0.0719 z M 34.65349,145.37166 c 0.0041,-0.0986 0.02412,-0.1187 0.05115,-0.0512 0.02446,0.0611 0.02145,0.13415 -0.0067,0.16228 -0.02813,0.0281 -0.04815,-0.0219 -0.04447,-0.11112 z m 19.304001,-0.33867 c 0.0041,-0.0986 0.02413,-0.11869 0.05115,-0.0512 0.02446,0.0611 0.02145,0.13414 -0.0067,0.16228 -0.02814,0.0281 -0.04815,-0.0219 -0.04447,-0.11113 z m -19.381984,-0.54328 c 0,-0.11641 0.01922,-0.16404 0.04271,-0.10583 0.02349,0.0582 0.02349,0.15346 0,0.21167 -0.02349,0.0582 -0.04271,0.0106 -0.04271,-0.10584 z m 14.89465,-0.0494 c 0.0041,-0.0986 0.02412,-0.11869 0.05115,-0.0512 0.02446,0.0611 0.02145,0.13414 -0.0067,0.16228 -0.02813,0.0281 -0.04814,-0.0219 -0.04447,-0.11113 z m 20.94299,-0.47977 -0.248673,-0.27517 0.275166,0.24867 c 0.256495,0.2318 0.314084,0.30166 0.248674,0.30166 -0.01457,0 -0.138396,-0.12382 -0.275167,-0.27516 z m -16.354614,-0.3175 c 0,-0.20955 0.01651,-0.29528 0.03669,-0.1905 0.02018,0.10477 0.02018,0.27622 0,0.381 -0.02018,0.10477 -0.03669,0.019 -0.03669,-0.1905 z m -14.984845,-0.381 c 6.35e-4,-0.23284 0.01708,-0.31804 0.03654,-0.18934 0.01946,0.1287 0.01894,0.3192 -0.0012,0.42333 -0.0201,0.10414 -0.03602,-10e-4 -0.03538,-0.23399 z m 14.986,-0.42334 c 6.78e-4,-0.23283 0.01708,-0.31803 0.03654,-0.18933 0.01946,0.1287 0.01894,0.3192 -0.0012,0.42333 -0.0201,0.10414 -0.03602,-0.001 -0.03538,-0.234 z m 6.738318,0.0635 c -0.105314,-0.13428 -0.102319,-0.13728 0.03197,-0.032 0.08149,0.0639 0.148167,0.13058 0.148167,0.14816 0,0.0697 -0.06953,0.0248 -0.180134,-0.1162 z m -11.321165,-0.86782 c 0,-0.11642 0.01922,-0.16404 0.0427,-0.10583 0.02349,0.0582 0.02349,0.15345 0,0.21166 -0.02349,0.0582 -0.0427,0.0106 -0.0427,-0.10583 z m -14.901334,-0.0847 c 0,-0.11641 0.01922,-0.16404 0.04271,-0.10583 0.02349,0.0582 0.02349,0.15346 0,0.21167 -0.02349,0.0582 -0.04271,0.0106 -0.04271,-0.10584 z m 4.565316,-0.30339 c 0.0041,-0.0986 0.02413,-0.11869 0.05115,-0.0512 0.02446,0.0611 0.02145,0.13414 -0.0067,0.16228 -0.02813,0.0281 -0.04814,-0.0219 -0.04447,-0.11113 z m -4.487333,-0.59266 c 0.0041,-0.0986 0.02412,-0.1187 0.05115,-0.0512 0.02446,0.0611 0.02145,0.13415 -0.0067,0.16228 -0.02813,0.0281 -0.04815,-0.0219 -0.04447,-0.11112 z m 10.306774,-4.74978 c 0.06112,-0.0245 0.134144,-0.0214 0.162278,0.007 0.02813,0.0281 -0.02187,0.0481 -0.111125,0.0445 -0.09863,-0.004 -0.118694,-0.0241 -0.05115,-0.0512 z m 20.526376,-5.1e-4 c 0.08149,-0.0213 0.214842,-0.0213 0.296333,0 0.08149,0.0213 0.01482,0.0387 -0.148166,0.0387 -0.162984,0 -0.229659,-0.0174 -0.148167,-0.0387 z m -14.464878,-1.40216 -0.161289,-0.1905 0.1905,0.16129 c 0.179022,0.15157 0.229043,0.21971 0.161289,0.21971 -0.01607,0 -0.101791,-0.0857 -0.1905,-0.1905 z m 96.824378,-1.8415 -2.413,-0.0463 2.38684,-0.0192 c 1.52094,-0.0122 2.40582,0.0115 2.43916,0.0655 0.0288,0.0466 0.0406,0.076 0.0262,0.0655 -0.0144,-0.0105 -1.11202,-0.04 -2.43917,-0.0655 z m 12.29784,-0.0633 c 0.64029,-0.0144 1.68804,-0.0144 2.32833,0 0.64029,0.0144 0.11642,0.0262 -1.16416,0.0262 -1.28059,0 -1.80446,-0.0118 -1.16417,-0.0262 z m 6.73612,-4e-5 c 0.6664,-0.0143 1.7332,-0.0143 2.37067,7e-5 0.63747,0.0144 0.0922,0.0261 -1.21162,0.026 -1.30387,-4e-5 -1.82544,-0.0118 -1.15905,-0.0261 z m 13.208,0 c 0.6664,-0.0143 1.7332,-0.0143 2.37067,7e-5 0.63747,0.0144 0.0922,0.0261 -1.21162,0.026 -1.30387,-4e-5 -1.82544,-0.0118 -1.15905,-0.0261 z m -133.688502,-0.1638 c 0.06112,-0.0245 0.134143,-0.0214 0.162278,0.007 0.02813,0.0281 -0.02187,0.0481 -0.111125,0.0445 -0.09863,-0.004 -0.118695,-0.0241 -0.05115,-0.0512 z m 20.32,-0.0847 c 0.06112,-0.0245 0.134145,-0.0215 0.162279,0.007 0.02813,0.0281 -0.02187,0.0482 -0.111125,0.0445 -0.09863,-0.004 -0.118695,-0.0241 -0.05115,-0.0512 z' style='fill:#fcb25c;stroke-width:0.0846667' /><path id='path84' d='m 86.316252,153.91371 c 0.08238,-0.0215 0.196678,-0.0201 0.254,0.003 0.05732,0.0232 -0.01008,0.0408 -0.149778,0.039 -0.1397,-0.002 -0.1866,-0.0207 -0.104222,-0.0422 z m 46.565058,3.3e-4 c 0.0815,-0.0213 0.21484,-0.0213 0.29633,0 0.0815,0.0213 0.0148,0.0387 -0.14816,0.0387 -0.16299,0 -0.22966,-0.0174 -0.14817,-0.0387 z m -47.704377,-0.0841 c 0.06112,-0.0245 0.134144,-0.0215 0.162278,0.007 0.02813,0.0281 -0.02187,0.0482 -0.111125,0.0445 -0.09863,-0.004 -0.118695,-0.0241 -0.05115,-0.0512 z m 9.707778,-5.69952 c 0,-3.00355 0.0106,-4.23228 0.02356,-2.7305 0.01295,1.50177 0.01295,3.95922 0,5.461 -0.01295,1.50177 -0.02356,0.27305 -0.02356,-2.7305 z m 12.869449,-0.29633 c 1e-5,-3.16654 0.0106,-4.44963 0.0234,-2.85132 0.0129,1.59831 0.0129,4.18911 -10e-6,5.75733 -0.0129,1.56823 -0.0234,0.26052 -0.0234,-2.90601 z m 9.82166,-1.016 c 1e-5,-3.72534 0.0104,-5.23697 0.0231,-3.3592 0.0127,1.87778 0.0127,4.92578 -1e-5,6.77334 -0.0127,1.84755 -0.0231,0.31119 -0.0231,-3.41414 z m -35.526479,5.56683 c -0.105315,-0.13429 -0.10232,-0.13728 0.03197,-0.032 0.08149,0.0639 0.148167,0.13059 0.148167,0.14817 0,0.0697 -0.06953,0.0248 -0.180133,-0.1162 z m 45.127329,-0.508 c -0.1053,-0.13429 -0.10232,-0.13728 0.032,-0.032 0.14103,0.11061 0.18589,0.18014 0.1162,0.18014 -0.0176,0 -0.0842,-0.0667 -0.14817,-0.14817 z m -39.121071,-0.587 c 0.06112,-0.0245 0.134145,-0.0215 0.162278,0.007 0.02813,0.0281 -0.02187,0.0481 -0.111125,0.0445 -0.09863,-0.004 -0.118694,-0.0241 -0.05115,-0.0512 z m 44.280671,0 c 0.0611,-0.0245 0.13414,-0.0215 0.16228,0.007 0.0281,0.0281 -0.0219,0.0481 -0.11113,0.0445 -0.0986,-0.004 -0.11869,-0.0241 -0.0512,-0.0512 z m 1.524,0 c 0.0611,-0.0245 0.13414,-0.0215 0.16228,0.007 0.0281,0.0281 -0.0219,0.0481 -0.11113,0.0445 -0.0986,-0.004 -0.11869,-0.0241 -0.0512,-0.0512 z m 3.06387,-1.15947 c 0,-0.0176 0.0667,-0.0842 0.14817,-0.14816 0.13429,-0.10532 0.13728,-0.10232 0.032,0.032 -0.11061,0.14104 -0.18014,0.18589 -0.18014,0.1162 z m 0.42334,-0.42333 c 0,-0.0176 0.0667,-0.0843 0.14816,-0.14817 0.13429,-0.10531 0.13728,-0.10232 0.032,0.032 -0.1106,0.14103 -0.18013,0.18588 -0.18013,0.1162 z m -56.719988,-0.86409 c 0.0041,-0.0986 0.02412,-0.11869 0.05115,-0.0512 0.02446,0.0611 0.02145,0.13414 -0.0067,0.16228 -0.02813,0.0281 -0.04815,-0.0219 -0.04447,-0.11113 z m 3.057821,-0.83961 c 0.0017,-0.1397 0.0207,-0.1866 0.04217,-0.10422 0.02147,0.0824 0.02005,0.19668 -0.0031,0.254 -0.02319,0.0573 -0.04076,-0.0101 -0.03903,-0.14978 z m 40.291507,-2.54706 c 0.004,-0.0986 0.0241,-0.11869 0.0512,-0.0512 0.0245,0.0611 0.0215,0.13414 -0.007,0.16228 -0.0281,0.0281 -0.0481,-0.0219 -0.0445,-0.11113 z m 3.13936,-0.45861 c 0,-0.11641 0.0192,-0.16404 0.0427,-0.10583 0.0235,0.0582 0.0235,0.15346 0,0.21167 -0.0235,0.0582 -0.0427,0.0106 -0.0427,-0.10584 z m 15.23331,0.0353 c 0.004,-0.0986 0.0241,-0.11869 0.0512,-0.0512 0.0245,0.0611 0.0215,0.13414 -0.007,0.16228 -0.0281,0.0281 -0.0481,-0.0219 -0.0445,-0.11113 z m -18.45064,-0.37394 c 0,-0.11642 0.0192,-0.16405 0.0427,-0.10584 0.0235,0.0582 0.0235,0.15346 0,0.21167 -0.0235,0.0582 -0.0427,0.0106 -0.0427,-0.10583 z m 15.33265,-0.46567 c 9.3e-4,-0.18627 0.0183,-0.2525 0.0385,-0.14718 0.0203,0.10532 0.0195,0.25772 -0.002,0.33867 -0.0212,0.081 -0.0378,-0.005 -0.0368,-0.19149 z m 3.21248,-0.762 c 0.002,-0.1397 0.0207,-0.1866 0.0422,-0.10422 0.0215,0.0824 0.0201,0.19668 -0.003,0.254 -0.0232,0.0573 -0.0408,-0.0101 -0.039,-0.14978 z m -15.41916,-0.007 c 0.004,-0.0986 0.0241,-0.1187 0.0512,-0.0512 0.0245,0.0611 0.0215,0.13415 -0.007,0.16228 -0.0281,0.0281 -0.0481,-0.0219 -0.0445,-0.11112 z m 12.20668,-0.75495 c 9.3e-4,-0.18627 0.0183,-0.2525 0.0385,-0.14718 0.0203,0.10532 0.0195,0.25772 -0.002,0.33867 -0.0212,0.081 -0.0378,-0.005 -0.0368,-0.19149 z m -15.33934,-0.51506 c 0.004,-0.0986 0.0241,-0.11869 0.0511,-0.0512 0.0245,0.0611 0.0215,0.13414 -0.007,0.16228 -0.0281,0.0281 -0.0481,-0.0219 -0.0445,-0.11113 z m 3.21733,-0.33866 c 0.004,-0.0986 0.0241,-0.1187 0.0512,-0.0512 0.0245,0.0611 0.0214,0.13415 -0.007,0.16228 -0.0281,0.0281 -0.0482,-0.0219 -0.0445,-0.11112 z m -3.13267,-0.508 c 0.004,-0.0986 0.0241,-0.1187 0.0512,-0.0512 0.0245,0.0611 0.0215,0.13415 -0.007,0.16228 -0.0281,0.0281 -0.0481,-0.0219 -0.0445,-0.11112 z m -29.040661,-0.0847 c 0.0041,-0.0986 0.02412,-0.11869 0.05115,-0.0512 0.02446,0.0611 0.02145,0.13414 -0.0067,0.16228 -0.02813,0.0281 -0.04815,-0.0219 -0.04447,-0.11113 z m 12.869331,-0.42333 c 0.004,-0.0986 0.0241,-0.1187 0.0512,-0.0512 0.0245,0.0611 0.0215,0.13415 -0.007,0.16228 -0.0281,0.0281 -0.0482,-0.0219 -0.0445,-0.11112 z m 12.79763,-1.22061 c 0,-0.16299 0.0174,-0.22966 0.0387,-0.14817 0.0213,0.0815 0.0213,0.21484 0,0.29633 -0.0213,0.0815 -0.0387,0.0148 -0.0387,-0.14816 z m 8.27769,-2.40264 c 0,-0.0176 0.0667,-0.0842 0.14817,-0.14816 0.13429,-0.10532 0.13728,-0.10232 0.032,0.032 -0.11061,0.14104 -0.18014,0.18589 -0.18014,0.1162 z m -32.385002,-0.22211 c 0.08429,-0.0931 0.172295,-0.16933 0.195578,-0.16933 0.02328,0 -0.02663,0.0762 -0.110911,0.16933 -0.08429,0.0931 -0.172295,0.16933 -0.195579,0.16933 -0.02328,0 0.02663,-0.0762 0.110912,-0.16933 z m 6.937342,-0.35983 -0.24867,-0.27517 0.27516,0.24867 c 0.15134,0.13677 0.27517,0.2606 0.27517,0.27517 0,0.0654 -0.0699,0.008 -0.30166,-0.24867 z m -24.992509,-0.88854 c 0.407458,-0.0155 1.074208,-0.0155 1.481666,0 0.407459,0.0155 0.07408,0.0282 -0.740833,0.0282 -0.814917,0 -1.148292,-0.0127 -0.740833,-0.0282 z m 8.125618,1.7e-4 2.939785,-0.024 0.02727,-1.14202 0.02727,-1.14202 -0.0037,1.16428 -0.0037,1.16425 -2.963333,0.002 -2.963334,0.002 2.939785,-0.024 z m 12.834674,-0.0796 c 0.06112,-0.0245 0.134144,-0.0215 0.162278,0.007 0.02813,0.0281 -0.02187,0.0481 -0.111125,0.0445 -0.09863,-0.004 -0.118694,-0.0241 -0.05115,-0.0511 z m 1.862667,0 c 0.0611,-0.0245 0.13414,-0.0215 0.16228,0.007 0.0281,0.0281 -0.0219,0.0481 -0.11113,0.0445 -0.0986,-0.004 -0.11869,-0.0241 -0.0512,-0.0511 z m 32.766,0 c 0.0611,-0.0245 0.13415,-0.0215 0.16228,0.007 0.0281,0.0281 -0.0219,0.0481 -0.11112,0.0445 -0.0986,-0.004 -0.1187,-0.0241 -0.0512,-0.0511 z m -26.23079,-0.0588 c 0,-0.0176 0.0667,-0.0843 0.14817,-0.14817 0.13428,-0.10531 0.13728,-0.10232 0.032,0.032 -0.1106,0.14103 -0.18013,0.18588 -0.18013,0.1162 z m -2.21213,-1.21687 c -0.10532,-0.13429 -0.10232,-0.13728 0.032,-0.032 0.0815,0.0639 0.14817,0.13059 0.14817,0.14817 0,0.0697 -0.0695,0.0248 -0.18013,-0.1162 z m -5.59308,-1.349 c 0.06112,-0.0245 0.13414,-0.0214 0.16228,0.007 0.0281,0.0281 -0.0219,0.0481 -0.11113,0.0445 -0.09863,-0.004 -0.118691,-0.0241 -0.05115,-0.0512 z m 1.94733,0 c 0.0611,-0.0245 0.13415,-0.0214 0.16228,0.007 0.0281,0.0281 -0.0219,0.0481 -0.11112,0.0445 -0.0986,-0.004 -0.1187,-0.0241 -0.0512,-0.0512 z m 10.83205,0.002 c 0.0582,-0.0235 0.15345,-0.0235 0.21166,0 0.0582,0.0235 0.0106,0.0427 -0.10583,0.0427 -0.11642,0 -0.16404,-0.0192 -0.10583,-0.0427 z m 2.03729,-0.002 c 0.0611,-0.0245 0.13414,-0.0214 0.16228,0.007 0.0281,0.0281 -0.0219,0.0481 -0.11113,0.0445 -0.0986,-0.004 -0.11869,-0.0241 -0.0511,-0.0512 z m 17.18733,0 c 0.0611,-0.0245 0.13415,-0.0214 0.16228,0.007 0.0281,0.0281 -0.0219,0.0481 -0.11112,0.0445 -0.0986,-0.004 -0.1187,-0.0241 -0.0512,-0.0512 z' style='fill:#969696;stroke-width:0.0846667' /><path id='path82' d='m 43.261639,153.74697 c 0.05821,-0.0235 0.153458,-0.0235 0.211667,0 0.05821,0.0235 0.01058,0.0427 -0.105834,0.0427 -0.116416,0 -0.164041,-0.0192 -0.105833,-0.0427 z m 1.947334,0 c 0.05821,-0.0235 0.153458,-0.0235 0.211666,0 0.05821,0.0235 0.01058,0.0427 -0.105833,0.0427 -0.116417,0 -0.164042,-0.0192 -0.105833,-0.0427 z m 24.659167,-1.49989 c 0,-0.0176 0.06668,-0.0843 0.148167,-0.14817 0.134286,-0.10531 0.137281,-0.10232 0.03197,0.032 -0.110606,0.14103 -0.180134,0.18588 -0.180134,0.1162 z m -18.923001,-0.64537 c 0.08429,-0.0931 0.172295,-0.16933 0.195579,-0.16933 0.02328,0 -0.02663,0.0762 -0.110912,0.16933 -0.08429,0.0931 -0.172295,0.16934 -0.195578,0.16934 -0.02328,0 0.02663,-0.0762 0.110911,-0.16934 z m -6.7945,-1.41303 c 0.08149,-0.0213 0.214842,-0.0213 0.296334,0 0.08149,0.0213 0.01482,0.0387 -0.148167,0.0387 -0.162984,0 -0.229659,-0.0174 -0.148167,-0.0387 z m 3.8735,-1.4976 c 0,-0.0176 0.06668,-0.0843 0.148167,-0.14817 0.134286,-0.10531 0.137281,-0.10232 0.03197,0.032 -0.110606,0.14103 -0.180134,0.18588 -0.180134,0.1162 z m 19.002341,-2.10587 -0.248673,-0.27516 0.275166,0.24867 c 0.151342,0.13677 0.275167,0.26059 0.275167,0.27517 0,0.0654 -0.06986,0.008 -0.30166,-0.24868 z m -32.450973,-2.43416 c 0,-0.11642 0.01922,-0.16405 0.04271,-0.10584 0.02349,0.0582 0.02349,0.15346 0,0.21167 -0.02349,0.0582 -0.04271,0.0106 -0.04271,-0.10583 z m 4.490471,-0.29634 c 0.0017,-0.1397 0.0207,-0.1866 0.04217,-0.10422 0.02147,0.0824 0.02005,0.19668 -0.0031,0.254 -0.02319,0.0573 -0.04076,-0.0101 -0.03903,-0.14978 z m 0.0031,-1.22766 c 0,-0.16299 0.01742,-0.22966 0.03872,-0.14817 0.0213,0.0815 0.0213,0.21484 0,0.29633 -0.0213,0.0815 -0.03872,0.0148 -0.03872,-0.14816 z m 21.394616,-0.0635 -0.205258,-0.23284 0.232834,0.20526 c 0.128058,0.11289 0.232833,0.21767 0.232833,0.23283 0,0.0664 -0.06856,0.0124 -0.260409,-0.20525 z m -25.888187,-0.27517 c 0,-0.11642 0.01922,-0.16404 0.04271,-0.10583 0.02349,0.0582 0.02349,0.15345 0,0.21166 -0.02349,0.0582 -0.04271,0.0106 -0.04271,-0.10583 z m 6.082632,-4.60397 c 0,-0.0176 0.06668,-0.0842 0.148167,-0.14816 0.134286,-0.10532 0.13728,-0.10232 0.03197,0.032 -0.110606,0.14104 -0.180133,0.18589 -0.180133,0.1162 z m 7.146289,-0.15853 -0.161289,-0.1905 0.1905,0.16129 c 0.179023,0.15157 0.229044,0.21971 0.161289,0.21971 -0.01607,0 -0.101791,-0.0857 -0.1905,-0.1905 z m 17.39117,-1.222 c 0.06112,-0.0245 0.134145,-0.0214 0.162278,0.007 0.02813,0.0281 -0.02187,0.0481 -0.111125,0.0445 -0.09863,-0.004 -0.118694,-0.0241 -0.05115,-0.0512 z m -13.7912,-1.02167 -0.205259,-0.23283 0.232834,0.20526 c 0.217618,0.19184 0.27166,0.26041 0.205258,0.26041 -0.01517,0 -0.11994,-0.10478 -0.232833,-0.23284 z m -14.132926,-0.0477 c 0,-0.0146 0.123825,-0.13839 0.275167,-0.27516 l 0.275167,-0.24868 -0.248674,0.27517 c -0.231799,0.25649 -0.30166,0.31408 -0.30166,0.24867 z m 23.241001,-0.82013 c 0.08429,-0.0931 0.172295,-0.16933 0.195579,-0.16933 0.02328,0 -0.02663,0.0762 -0.110912,0.16933 -0.08429,0.0931 -0.172295,0.16933 -0.195578,0.16933 -0.02328,0 0.02663,-0.0762 0.110911,-0.16933 z m 4.429125,-1.6665 c 0.06112,-0.0245 0.134145,-0.0215 0.162278,0.007 0.02813,0.0281 -0.02187,0.0482 -0.111125,0.0445 -0.09863,-0.004 -0.118694,-0.0241 -0.05115,-0.0512 z m 1.524,0 c 0.06112,-0.0245 0.134145,-0.0215 0.162279,0.007 0.02813,0.0281 -0.02187,0.0482 -0.111125,0.0445 -0.09863,-0.004 -0.118695,-0.0241 -0.05115,-0.0512 z' style='fill:#fc9929;stroke-width:0.0846667' /><path id='path80' d='m 42.906207,153.71575 c -4.485963,-0.51325 -7.168398,-2.99511 -8.049962,-7.44804 -0.412693,-2.08458 -0.320129,-5.10045 0.216985,-7.06966 0.311042,-1.14038 0.95417,-2.42918 1.638738,-3.28398 1.241652,-1.55041 2.876755,-2.50147 5.089171,-2.96011 1.182048,-0.24504 3.68793,-0.26118 4.910667,-0.0316 2.48589,0.46669 4.342924,1.62611 5.619072,3.50821 0.679917,1.00275 1.218173,2.41699 1.504447,3.95284 0.243823,1.3081 0.225639,4.65589 -0.03196,5.88433 -0.254428,1.21332 -0.466052,1.84183 -0.955023,2.83634 -1.19184,2.42406 -3.362543,3.98939 -6.221201,4.48621 -0.946061,0.16442 -2.826388,0.22784 -3.720932,0.12549 z m 2.958932,-3.69611 c 2.480232,-0.61363 3.68438,-2.83816 3.680824,-6.79993 -0.0018,-2.02846 -0.200958,-3.10737 -0.80695,-4.37198 -0.824677,-1.72099 -2.260994,-2.56774 -4.35554,-2.56774 -2.251901,0 -3.90387,1.05425 -4.663266,2.97599 -0.731015,1.84992 -0.859297,4.95723 -0.291994,7.07281 0.61702,2.30099 1.972386,3.57659 4.066259,3.82695 0.726774,0.0869 1.693695,0.0314 2.370667,-0.1361 z m 17.314334,3.72732 c -1.515664,-0.14825 -2.622773,-0.3988 -3.788833,-0.85743 l -0.783167,-0.30804 v -1.98061 c 0,-1.5512 0.02295,-1.97121 0.105833,-1.93721 3.161829,1.29681 4.598229,1.65076 6.336887,1.56152 1.019238,-0.0523 1.528414,-0.20863 2.003102,-0.61494 0.467398,-0.40008 0.637465,-0.79922 0.647531,-1.51975 0.01685,-1.20601 -0.519947,-1.70614 -3.378353,-3.14758 -2.364276,-1.19226 -3.143188,-1.69507 -3.928488,-2.53596 -2.179711,-2.33401 -2.03138,-6.1028 0.318926,-8.10326 1.634387,-1.3911 4.47764,-1.89622 7.419563,-1.31811 0.851237,0.16727 2.891111,0.81325 3.397971,1.07606 l 0.272059,0.14106 -0.65739,1.58815 c -0.361563,0.87349 -0.676468,1.60724 -0.699787,1.63056 -0.02332,0.0233 -0.445567,-0.10904 -0.938327,-0.29413 -2.806584,-1.0542 -5.006095,-1.09776 -5.915694,-0.11716 -0.380447,0.41014 -0.521402,0.78386 -0.521402,1.38242 0,1.1968 0.485346,1.65085 3.236593,3.02788 3.4071,1.70529 4.511748,2.59125 5.182809,4.15678 0.484781,1.13094 0.544111,2.93221 0.137544,4.17583 -0.722666,2.21052 -2.804355,3.61977 -5.848372,3.9592 -0.76359,0.0851 -1.924868,0.10066 -2.599005,0.0347 z m 81.924357,-0.30375 c 0.0339,-0.0582 1.56234,-2.44284 3.39648,-5.29918 3.12327,-4.86394 3.32732,-5.20496 3.2169,-5.37633 -2.31686,-3.59588 -6.15707,-9.61884 -6.15707,-9.65672 0,-0.0282 1.04228,-0.0513 2.31616,-0.0513 h 2.31616 l 2.1401,3.57717 c 1.17705,1.96744 2.18445,3.62524 2.23868,3.68399 0.0768,0.0832 0.57537,-0.70767 2.25358,-3.5747 l 2.15499,-3.68153 2.30536,-0.002 2.30535,-0.002 -0.55265,0.86784 c -2.98308,4.68433 -5.83223,9.23958 -5.81586,9.29843 0.0111,0.0399 1.56591,2.37895 3.45511,5.19783 l 3.43491,5.12524 -2.43911,-0.001 -2.43911,-0.001 -2.37066,-3.86423 c -1.30387,-2.12533 -2.40877,-3.85975 -2.45534,-3.85427 -0.0466,0.005 -1.15147,1.74487 -2.45533,3.8653 l -2.37067,3.85534 -2.26983,5e-5 c -1.79232,4e-5 -2.25686,-0.0222 -2.20815,-0.10579 z m 27.38032,-3.82998 v -3.93583 l -3.05595,-5.69501 c -1.68076,-3.13225 -3.20743,-5.97124 -3.3926,-6.30884 l -0.33665,-0.61384 2.3131,0.002 2.3131,0.002 2.11666,4.18825 c 1.16417,2.30354 2.14215,4.18859 2.1733,4.18899 0.0311,4.2e-4 0.99601,-1.85665 2.14414,-4.12678 1.14813,-2.27012 2.11578,-4.15671 2.15034,-4.19241 0.0346,-0.0357 1.07728,-0.0548 2.31713,-0.0423 l 2.2543,0.0226 -3.38012,6.223 -3.38012,6.223 -0.002,4.0005 -0.002,4.0005 h -2.11667 -2.11666 v -3.93582 z' style='fill:#fb9219;stroke-width:0.0846667' /><path id='path78' d='m 85.430933,153.82988 c 0.06112,-0.0245 0.134144,-0.0214 0.162278,0.007 0.02813,0.0281 -0.02187,0.0481 -0.111125,0.0445 -0.09863,-0.004 -0.118695,-0.0241 -0.05115,-0.0512 z m 1.947333,0 c 0.06112,-0.0245 0.134144,-0.0214 0.162278,0.007 0.02813,0.0281 -0.02187,0.0481 -0.111125,0.0445 -0.09863,-0.004 -0.118694,-0.0241 -0.05115,-0.0512 z m 44.529374,0.002 c 0.0582,-0.0235 0.15346,-0.0235 0.21167,0 0.0582,0.0235 0.0106,0.0427 -0.10583,0.0427 -0.11642,0 -0.16404,-0.0192 -0.10584,-0.0427 z m 2.2913,-0.002 c 0.0611,-0.0245 0.13414,-0.0214 0.16228,0.007 0.0281,0.0281 -0.0219,0.0481 -0.11113,0.0445 -0.0986,-0.004 -0.11869,-0.0241 -0.0512,-0.0512 z m -46.143341,-0.0847 c 0.06112,-0.0245 0.134145,-0.0215 0.162278,0.007 0.02813,0.0281 -0.02187,0.0481 -0.111125,0.0445 -0.09863,-0.004 -0.118694,-0.0241 -0.05115,-0.0511 z m 3.783024,-10.29266 5.18e-4,-10.0965 1.27,-0.004 1.27,-0.004 -1.248489,0.0271 -1.24849,0.0271 -0.02203,10.07308 -0.02203,10.07307 5.08e-4,-10.0965 z m 12.867887,3.28086 c 0,-3.7719 0.0104,-5.32732 0.0231,-3.45648 0.0127,1.87083 0.0127,4.95693 1e-5,6.858 -0.0127,1.90106 -0.0231,0.37038 -0.0231,-3.40152 z m 15.91734,-0.0423 c 0,-3.79519 0.0104,-5.34776 0.0231,-3.45017 0.0127,1.89759 0.0127,5.00274 0,6.90033 -0.0127,1.89759 -0.0231,0.34502 -0.0231,-3.45016 z m 6.05563,4.699 c -0.20566,-0.20955 -0.35487,-0.381 -0.33159,-0.381 0.0233,0 0.2106,0.17145 0.41625,0.381 0.20566,0.20955 0.35488,0.381 0.33159,0.381 -0.0233,0 -0.2106,-0.17145 -0.41625,-0.381 z m -40.068506,-0.0137 c 0.05821,-0.0235 0.153459,-0.0235 0.211667,0 0.05821,0.0235 0.01058,0.0427 -0.105833,0.0427 -0.116417,0 -0.164042,-0.0192 -0.105834,-0.0427 z m 0.592667,-0.004 c 0.104775,-0.0202 0.276225,-0.0202 0.381,0 0.104775,0.0202 0.01905,0.0367 -0.1905,0.0367 -0.20955,0 -0.295275,-0.0165 -0.1905,-0.0367 z m 42.050129,-1.31608 -0.16129,-0.1905 0.1905,0.16129 c 0.17902,0.15157 0.22904,0.21971 0.16129,0.21971 -0.0161,0 -0.1018,-0.0857 -0.1905,-0.1905 z m -0.46843,-0.46567 c -0.10531,-0.13428 -0.10232,-0.13728 0.032,-0.032 0.0815,0.0639 0.14817,0.13058 0.14817,0.14816 0,0.0697 -0.0695,0.0248 -0.18014,-0.1162 z m -48.151165,-1.03716 c 0,-0.11641 0.01922,-0.16404 0.0427,-0.10583 0.02349,0.0582 0.02349,0.15346 0,0.21167 -0.02349,0.0582 -0.0427,0.0106 -0.0427,-0.10584 z m 3.041317,-0.21872 c 0.0041,-0.0986 0.02412,-0.11869 0.05115,-0.0512 0.02446,0.0611 0.02145,0.13414 -0.0067,0.16228 -0.02813,0.0281 -0.04815,-0.0219 -0.04447,-0.11113 z m 58.589328,-2.70933 c 0.004,-0.0986 0.0241,-0.1187 0.0512,-0.0512 0.0245,0.0611 0.0214,0.13415 -0.007,0.16228 -0.0281,0.0281 -0.0482,-0.0219 -0.0445,-0.11112 z m 0.0847,-0.84667 c 0.004,-0.0986 0.0241,-0.11869 0.0512,-0.0511 0.0245,0.0611 0.0215,0.13414 -0.007,0.16228 -0.0281,0.0281 -0.0481,-0.0219 -0.0445,-0.11113 z m -3.12598,-0.11994 c 0,-0.11642 0.0192,-0.16405 0.0427,-0.10584 0.0235,0.0582 0.0235,0.15346 0,0.21167 -0.0235,0.0582 -0.0427,0.0106 -0.0427,-0.10583 z m -15.31671,-0.46543 c 9.3e-4,-0.18627 0.0183,-0.2525 0.0385,-0.14718 0.0203,0.10532 0.0195,0.25772 -0.002,0.33867 -0.0212,0.081 -0.0378,-0.005 -0.0368,-0.19149 z m 3.13669,-0.21167 c 0,-0.25611 0.0159,-0.36089 0.0353,-0.23283 0.0194,0.12806 0.0194,0.33761 0,0.46567 -0.0194,0.12805 -0.0353,0.0233 -0.0353,-0.23284 z m 0,-1.10066 c 0,-0.25612 0.0159,-0.3609 0.0353,-0.23284 0.0194,0.12806 0.0194,0.33761 0,0.46567 -0.0194,0.12806 -0.0353,0.0233 -0.0353,-0.23283 z m -3.13383,-0.21167 c 8.5e-4,-0.23283 0.0171,-0.31803 0.0365,-0.18934 0.0195,0.1287 0.0189,0.3192 -0.001,0.42334 -0.0201,0.10413 -0.036,-0.001 -0.0354,-0.234 z m -29.039511,-0.381 c 0,-0.25612 0.01587,-0.36089 0.03527,-0.23283 0.0194,0.12805 0.0194,0.3376 0,0.46566 -0.0194,0.12806 -0.03527,0.0233 -0.03527,-0.23283 z m 44.353331,-0.0847 c 0,-0.11641 0.0192,-0.16404 0.0427,-0.10583 0.0235,0.0582 0.0235,0.15346 0,0.21167 -0.0235,0.0582 -0.0427,0.0106 -0.0427,-0.10584 z m 3.12598,-0.13405 c 0.004,-0.0986 0.0241,-0.1187 0.0512,-0.0512 0.0245,0.0611 0.0215,0.13415 -0.007,0.16228 -0.0281,0.0281 -0.0481,-0.0219 -0.0445,-0.11112 z m -34.61113,-0.33161 c 6.8e-4,-0.23284 0.0171,-0.31804 0.0365,-0.18934 0.0195,0.1287 0.0189,0.3192 -0.001,0.42333 -0.0201,0.10414 -0.036,-0.001 -0.0354,-0.23399 z m 16.23846,-0.17639 c 0.004,-0.0986 0.0241,-0.1187 0.0512,-0.0512 0.0245,0.0611 0.0215,0.13415 -0.007,0.16228 -0.0281,0.0281 -0.0481,-0.0219 -0.0445,-0.11112 z m 3.13267,0 c 0.004,-0.0986 0.0241,-0.1187 0.0512,-0.0512 0.0245,0.0611 0.0214,0.13415 -0.007,0.16228 -0.0281,0.0281 -0.0482,-0.0219 -0.0445,-0.11112 z m 15.15533,-0.254 c 0.004,-0.0986 0.0241,-0.1187 0.0512,-0.0512 0.0245,0.0611 0.0214,0.13415 -0.007,0.16228 -0.0281,0.0281 -0.0482,-0.0219 -0.0445,-0.11112 z m -47.328661,-0.33867 c 0.0041,-0.0986 0.02412,-0.11869 0.05115,-0.0511 0.02446,0.0611 0.02145,0.13414 -0.0067,0.16228 -0.02813,0.0281 -0.04815,-0.0219 -0.04447,-0.11113 z m 22.615821,-1.09361 c 0.002,-0.1397 0.0207,-0.1866 0.0422,-0.10422 0.0215,0.0824 0.02,0.19668 -0.003,0.254 -0.0232,0.0573 -0.0408,-0.0101 -0.039,-0.14978 z m 2.95351,-1.10772 c 0.004,-0.0986 0.0241,-0.1187 0.0512,-0.0512 0.0245,0.0611 0.0215,0.13415 -0.007,0.16228 -0.0281,0.0281 -0.0482,-0.0219 -0.0445,-0.11112 z m 8.12132,-1.33725 c 0,-0.0176 0.0667,-0.0842 0.14817,-0.14816 0.13429,-0.10532 0.13728,-0.10232 0.032,0.032 -0.11061,0.14104 -0.18014,0.18589 -0.18014,0.1162 z m 8.67029,-0.32786 -0.16129,-0.1905 0.1905,0.16129 c 0.17902,0.15157 0.22904,0.21971 0.16129,0.21971 -0.0161,0 -0.10179,-0.0857 -0.1905,-0.1905 z m -8.16229,-0.18014 c 0,-0.0176 0.0667,-0.0842 0.14817,-0.14816 0.13429,-0.10532 0.13728,-0.10232 0.032,0.032 -0.11061,0.14104 -0.18014,0.18589 -0.18014,0.1162 z m -32.427335,-0.1693 c 0,-0.0176 0.06668,-0.0843 0.148166,-0.14817 0.134287,-0.10531 0.137282,-0.10232 0.03197,0.032 -0.110606,0.14103 -0.180133,0.18588 -0.180133,0.1162 z m 10.372265,-0.3904 c -0.0297,-0.048 0.004,-0.0622 0.0797,-0.0333 0.14668,0.0563 0.17352,0.11697 0.0517,0.11697 -0.0438,0 -0.10295,-0.0377 -0.1314,-0.0837 z m 19.5574,-0.9323 c 0.22933,-0.23283 0.43602,-0.42333 0.4593,-0.42333 0.0233,0 -0.1453,0.1905 -0.37463,0.42333 -0.22933,0.23283 -0.43602,0.42333 -0.4593,0.42333 -0.0233,0 0.14531,-0.1905 0.37463,-0.42333 z m -14.53621,0.19616 c 0.0611,-0.0245 0.13415,-0.0214 0.16228,0.007 0.0281,0.0281 -0.0219,0.0482 -0.11112,0.0445 -0.0986,-0.004 -0.1187,-0.0241 -0.0512,-0.0512 z m -11.85862,-0.0866 c 0.10477,-0.0202 0.27622,-0.0202 0.381,0 0.10477,0.0202 0.019,0.0367 -0.1905,0.0367 -0.20955,0 -0.29528,-0.0165 -0.1905,-0.0367 z m 12.91283,-0.001 c 0.1287,-0.0195 0.3192,-0.0189 0.42333,0.001 0.10414,0.0201 -10e-4,0.036 -0.23399,0.0354 -0.23284,-6.8e-4 -0.31804,-0.0171 -0.18934,-0.0365 z m 19.7685,0.001 c 0.10478,-0.0202 0.27623,-0.0202 0.381,0 0.10478,0.0202 0.019,0.0367 -0.1905,0.0367 -0.20955,0 -0.29527,-0.0165 -0.1905,-0.0367 z m -24.87083,-0.22072 c 0,-0.0146 0.12382,-0.1384 0.27517,-0.27517 l 0.27516,-0.24867 -0.24867,0.27517 c -0.2318,0.25649 -0.30166,0.31408 -0.30166,0.24867 z m 11.08053,-0.29101 c -0.10531,-0.13428 -0.10232,-0.13728 0.032,-0.032 0.0815,0.0639 0.14817,0.13058 0.14817,0.14816 0,0.0697 -0.0695,0.0248 -0.18014,-0.1162 z m -13.16019,-0.29633 -0.24867,-0.27517 0.27516,0.24868 c 0.15134,0.13677 0.27517,0.26059 0.27517,0.27516 0,0.0654 -0.0699,0.008 -0.30166,-0.24867 z m -20.891637,-1.39684 c 0.800271,-0.0139 2.133771,-0.0139 2.963334,-5e-5 0.829561,0.0139 0.174794,0.0252 -1.455039,0.0253 -1.629834,3e-5 -2.308567,-0.0113 -1.508295,-0.0252 z m 15.204737,-0.334 c 0.0824,-0.0215 0.19668,-0.0201 0.254,0.003 0.0573,0.0232 -0.0101,0.0408 -0.14977,0.039 -0.1397,-0.002 -0.1866,-0.0207 -0.10423,-0.0422 z m 1.14238,-10e-4 c 0.10532,-0.0203 0.25772,-0.0195 0.33867,0.002 0.0809,0.0212 -0.005,0.0378 -0.19149,0.0368 -0.18627,-9.4e-4 -0.2525,-0.0183 -0.14718,-0.0385 z m 11.72696,10e-4 c 0.0824,-0.0215 0.19668,-0.0201 0.254,0.003 0.0573,0.0232 -0.0101,0.0408 -0.14978,0.039 -0.1397,-0.002 -0.1866,-0.0207 -0.10422,-0.0422 z m 1.27,0 c 0.0824,-0.0215 0.19668,-0.0201 0.254,0.003 0.0573,0.0232 -0.0101,0.0408 -0.14978,0.039 -0.1397,-0.002 -0.1866,-0.0207 -0.10422,-0.0422 z m 17.90638,-10e-4 c 0.10531,-0.0203 0.25771,-0.0195 0.33866,0.002 0.081,0.0212 -0.005,0.0378 -0.19149,0.0368 -0.18626,-9.4e-4 -0.2525,-0.0183 -0.14717,-0.0385 z m 1.43933,0 c 0.10532,-0.0203 0.25772,-0.0195 0.33867,0.002 0.0809,0.0212 -0.005,0.0378 -0.19149,0.0368 -0.18627,-9.4e-4 -0.2525,-0.0183 -0.14718,-0.0385 z' style='fill:#575757;stroke-width:0.0846667' /><path id='path76' d='m 85.362141,153.82678 c -1.854099,-0.21167 -3.331954,-1.16143 -4.00792,-2.57575 -0.694242,-1.45256 -0.731886,-1.93369 -0.732719,-9.36482 l -6.95e-4,-6.20183 h -1.439333 -1.439333 v -0.71007 -0.71007 l 1.396537,-0.6142 c 0.768096,-0.33781 1.430698,-0.65645 1.472449,-0.70809 0.04175,-0.0516 0.354843,-1.03688 0.69576,-2.1894 l 0.61985,-2.0955 h 0.871035 0.871036 v 2.37066 2.37067 h 2.921 2.921 v 1.143 1.143 h -2.923501 -2.923501 l 0.02367,6.5405 0.02367,6.5405 0.19552,0.5414 c 0.502333,1.39096 1.620578,2.12717 3.227863,2.1251 0.356565,-4.2e-4 1.620215,-0.16894 2.27045,-0.30272 l 0.275167,-0.0566 v 1.15121 1.15122 l -0.4445,0.12873 c -1.044595,0.3025 -2.783341,0.44753 -3.8735,0.32307 z m 46.308879,-0.0322 c -0.67563,-0.0874 -1.83776,-0.41748 -2.49855,-0.70972 -1.21339,-0.53661 -2.6925,-1.79507 -3.43494,-2.92252 -1.36629,-2.07481 -1.97872,-4.79752 -1.76486,-7.84619 0.22058,-3.14453 1.01067,-5.11953 2.74126,-6.85236 1.5048,-1.50676 3.07294,-2.19037 5.51571,-2.40451 3.40513,-0.29851 6.28769,0.85692 8.09225,3.24367 1.35079,1.78658 2.10693,4.34124 2.10489,7.11156 -0.004,5.85259 -2.78554,9.62019 -7.633,10.33997 -0.95403,0.14166 -2.21259,0.15782 -3.12276,0.0401 z m 3.60876,-2.73073 c 2.64578,-0.86016 4.01569,-3.46375 4.01479,-7.63029 -9.3e-4,-4.32972 -1.47681,-6.91664 -4.37698,-7.67197 -0.80614,-0.20995 -2.33349,-0.24872 -3.20045,-0.0812 -2.47564,0.47826 -3.93512,2.18359 -4.49594,5.25331 -0.20595,1.12727 -0.20856,3.7973 -0.005,4.91067 0.26717,1.45985 0.65123,2.46283 1.28096,3.34533 0.51282,0.71864 1.04725,1.17006 1.86056,1.57154 0.98219,0.48485 1.54621,0.58866 3.01022,0.55403 1.04475,-0.0247 1.32957,-0.0622 1.91164,-0.25139 z m -43.398305,-7.59014 v -10.07533 h 1.215258 1.215259 l 0.100337,0.61383 c 0.251339,1.53763 0.37552,2.0955 0.466452,2.0955 0.05342,0 0.267653,-0.23425 0.476076,-0.52055 0.719514,-0.98837 1.991384,-1.855 3.319258,-2.26167 1.779855,-0.54509 4.467885,-0.33255 6.034365,0.47713 0.75067,0.38801 1.75183,1.37598 2.14281,2.11459 0.15407,0.29104 0.31046,0.52917 0.34755,0.52917 0.0371,0 0.22125,-0.21908 0.40925,-0.48683 1.47572,-2.10185 4.16315,-3.18914 7.17676,-2.9036 2.90865,0.2756 4.5571,1.46966 5.37315,3.89208 0.40246,1.19466 0.42444,1.68013 0.42498,9.38318 l 8.4e-4,7.21784 h -1.47771 -1.47772 l -0.0284,-7.26017 c -0.0283,-7.24161 -0.0289,-7.26176 -0.21832,-7.88266 -0.25629,-0.83996 -0.46602,-1.22863 -0.93156,-1.72632 -0.74908,-0.80046 -1.67481,-1.11609 -3.23266,-1.10207 -3.30667,0.0298 -5.02675,1.71004 -5.41431,5.28905 -0.0536,0.49486 -0.089,3.18284 -0.089,6.75216 v 5.93001 h -1.47727 -1.47727 l -0.0313,-7.1755 c -0.0341,-7.82811 -0.0265,-7.70205 -0.53083,-8.76723 -0.67515,-1.42593 -1.86099,-2.04344 -3.89168,-2.02655 -1.727657,0.0144 -2.78616,0.39251 -3.727237,1.3315 -0.778564,0.77684 -1.216669,1.73309 -1.532563,3.34511 -0.121608,0.62057 -0.145967,1.58533 -0.176901,7.00617 l -0.03587,6.2865 h -1.47588 -1.47588 z' style='fill:#000000;stroke-width:0.0846667' /></g></g></svg>";

/**
 * Run on device power-on
 * 
 * @author costmo
 * @return void
 */
void setup() 
{
  // wait for serial port to connect
  Serial.begin( 9600 );
  while (!Serial) {
    ;
  }
  delay( 100 );

  // Start our services
  startSoftAP();
  startWebServer();
  softSerial.begin( 9600 );
}


/**
 * Run while the sketch is active
 * 
 * @return void
 * @author costmo
 */
void loop() 
{
  // Listen for API requests on our running server/ports
  server.handleClient();
  server_443.handleClient();
  server_80.handleClient();

  int incomingByte = 0;
  
  // Redirect users to the login portal by virtue of DNS failure
  dnsServer.processNextRequest();

  // Ingest and handle incoming serial data
  // Currently an academic excercise - we don't do anything with incoming serial requests
//  if( !receiving ) {
//    bufferIndex = 0;
//    memset( buff, 0, bufferSize );
//  }
//  if( Serial.available() > 0 ) {
//    receiving = true;
//    // read the incoming byte:
//    incomingByte = Serial.read();
//
//    // EOL or buffer boundary protection
//    if( incomingByte != 10 || bufferIndex == (bufferSize - 1) ) {
//      buff[bufferIndex] = (char)incomingByte;
//      bufferIndex++;
//    } else {
//      receiving = false;
//    }
//  }
//
//  if( !receiving && bufferIndex > 0 ) {
//    Serial.print( "Got string: " );
//    Serial.println( buff );
//  }

  timeoutWAP();
  delay( tickDuration );
  currentTick++;
}


/**
 * Iterate through the known server instances to find the value of a POSTed key
 * 
 * @return String
 * @param key         The key to parse
 * @author costmo
 */
String postValue( String key )
{
    String returnValue = server.arg( key );
    if( returnValue.length() < 1 ) {
      returnValue = server_443.arg( key );
    }
    if( returnValue.length() < 1 ) {
      returnValue = server_80.arg( key );
    }

    return returnValue;
}


/**
 * Start the local (software) access point
 * 
 * @return void
 * @author costmo
 */
void startSoftAP()
{
  String mac = WiFi.macAddress();
  String macPartOne = mac.substring( 12, 14 );
  String macPartTwo = mac.substring( 15 );
  ssid = ssidPrefix + macPartOne + macPartTwo; // "printerX-" followed by the last 4 characters of the device MAC address

  WiFi.mode( WIFI_AP );
  WiFi.softAPConfig( WiFi.softAPIP(), WiFi.softAPIP(), IPAddress( 255, 255, 255, 0 ) );
  WiFi.softAP( ssid.c_str() );
  dnsServer.start( DNS_PORT, "*", WiFi.softAPIP() );
  
  softIP = WiFi.softAPIP().toString();
  
//  Serial.println( getSoftAPStatus() );
}


/**
 * Define the endpoints for a tiny API server for receiving and handling requests and start the web server on various (possibly) needed ports
 * 
 * @return void
 * @author costmo
 */
void startWebServer()
{
  server.on( "/", handleRoot );
  server.on( "/connect", handleConnect );
  server.on( "/shutdown", handleShutdownAP );
  server.onNotFound( handleRoot );
  server.begin();

  server_443.on( "/", handleRoot );
  server_443.on( "/connect", handleConnect );
  server_443.on( "/shutdown", handleShutdownAP );
  server_443.onNotFound( handleRoot );
  server_443.begin();

  server_80.on( "/", handleRoot );
  server_80.on( "/connect", handleConnect );
  server_80.on( "/shutdown", handleShutdownAP );
  server_80.onNotFound( handleRoot );
  server_80.begin();
}

/**
 * Gets the SSID and IP address of the local access point
 * 
 * @return String
 * @author costmo
 */
String getSoftAPStatus()
{
  String returnValue = "\n";
  returnValue += "SSID: " + ssid + "\n";
  returnValue += "IP  : " + softIP + "\n";

  return returnValue;
}

/**
 * Shut down the WAP after a pre-determined time.
 * 
 * Currently configured for 10 minutes after power-on
 * 
 * @return void
 * @author costmo
 */
void timeoutWAP()
{
  // Shut off the AP, but limit the number of times we try to do so -
  //   Guarantee that we are disconnected by issuing "disconnect" multiple times,
  //   but stop doing that after several ticks since at least one of them should 
  //   have succeeded
  if( currentTick >= timeoutTicks && currentTick < (timeoutTicks + 10) )
  {
    WiFi.softAPdisconnect( true );
  }
}


/**
 * Provide a common header for rendered web pages
 * 
 * @return String       Opening HTML envelope for the captive portal
 * @author costmo
 */
String commonHeader()
{
  String returnValue =
    "<!DOCTYPE HTML>"
    "<html>"
      "<head>"
        "<meta name='viewport' content='width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0'>"
        "<title>printerX | Connect to your WiFi network</title>"
        "<style>"
          "body { background-color: #DADADA; font-family: 'Open Sans', sans-serif; Color: #000000; }"
          "p { line-height: 28px; }"
          "#container { width: 90%; max-width: 640px; text-align: center; background-color: #FFFFFF; margin-left: auto; margin-right: auto; border: 1px solid gray;border-radius: 5px; padding: 10px; }"
          "#header { width: 100%; text-align: center; }"
          "svg { width: 80%; height: auto; }"
          "#exit_text{ font-size: 11px; text-align: left; }"
          "#exit_text p{ line-height: 20px; }"
          "p.error { color: red; font-weight: bold; }"
          "#question{ cursor: pointer; font-weight: bold; }"
          "#answer{ display: none; }"
          "input[type=text], input[type=password] { width: 90%; height: 30px; padding-left: 10px; }"
        "</style>"
        "<script type='text/javascript'>"
          "function showAnswer() {"
            "var element = document.getElementById( 'answer' );"
            "element.style.display = 'block';"
          "}"
        "</script>"
      "</head>"
      "<body>";

  return returnValue;
}

/**
 * Provide a common footer for rendered web pages
 * 
 * @return String         Closing HTML envelope for the captive portal
 * @author costmo
 */
String commonFooter()
{
  String returnValue = "</body></html>";
  return returnValue;
}

/**
 * Handler for requests foro "/"
 * 
 * This should only provide the interface for providing WiFi credentials
 * 
 * @return void
 * @author costmo
 */
void handleRoot()
{
//  Serial.println( "Connecting" );
 
  server.send( 200, "text/html", connectionHtml() );
  server_443.send( 200, "text/html", connectionHtml() );
  server_80.send( 200, "text/html", connectionHtml() );
  
  delay( 100 );
}

/**
 * Handle a request to shutdown the soft AP
 * 
 * Sends an appropriate status page to the web browser, which should be a captive portal page
 * 
 * @return void
 * @author costmo
 */
void handleShutdownAP()
{
   String html =
    commonHeader() +
    "<div id='container'>"
      "<div id='header'>"
        "<h3>Disabling Wireless Access Point</h3>"
      "</div>"
      "<div id='content'>"
        "<p>The <strong>printerX</strong> Wireless Access Point is powering down.</p>"
        "<div id='exit_text'>"
          "<p>If you need for the WAP to be available again, restart the <strong>printerX</strong> web server.</p>"
          "<p>This screen will disappear automatically in a few seconds.</p>"
        "</div>"
      "</div>"
    "</div>" +
    commonFooter();

  server.send( 200, "text/html", html );
  server_443.send( 200, "text/html", html );
  server_80.send( 200, "text/html", html );

  delay( 7000 );
  WiFi.softAPdisconnect( true );
}

/**
 * Handle POST requests to /connect - an attempt to reconfigure the printer's WiFi credentials
 * 
 * Sends an appropriate status page to the web browser, which should be a captive portal page
 * 
 * @return void
 * @author costmo
 */
void handleConnect()
{
  String hardSSID = postValue( "ssid" );
  String hardPassword = postValue( "password" );
  bool doSet = false;

  // Show the user a message
  // Common/top part first
  String html = 
    commonHeader() +
    "<div id='container'>"
      "<div id='header'>"
        "<h3>Connecting to your WiFi network...</h3>"
      "</div>"
      "<div id='content'>";

    // Insufficient input
    if( hardSSID.length() < 1 )
    {
      html +=
        "<p class='error'>You must supply an SSID.</p>"
        "<p><a href='/'>Click here</a> to go back to the form and try again.</p>";
    } else { // OK
      doSet = true;
      html +=
        "<p>The <strong>printerX</strong> web server will now restart so that it can connect to<br/>the WiFi network named <strong>" + hardSSID + "</strong></p>"
        "<div id='exit_text'>"
          "<p>You should be able to access your printer in a web browser at <a href='http://printerx.local/'>http://printerX.local/</a> in about 30 seconds.</p>"
          "<p>If your printer fails to connect to your network, <a href='/'>click here</a> to try again.</p>"
          "<p>If you are done, CANCEL this screen and reconnect to your network.</p>"
          "<p>For security purposes, this Wireless Access Point will only remain active for 10 minutes. If you wish to shut down the WAP right now, <a href='/shutdown'>click here</a>.</p>"
        "</div>";
    }
    html += 
      "</div>"
    "</div>"+
    commonFooter();
  
  server.send( 200, "text/html", html );
  server_443.send( 200, "text/html", html );
  server_80.send( 200, "text/html", html );

  // Send the instruction to reset credentials to the rPi
  if( doSet ) {

    String sendString = "{\"action\":\"set-wifi\",\"ssid\":\"";
    sendString += hardSSID;
    sendString += "\",\"password\":\"";
    sendString += hardPassword;
    sendString += "\"}";

//    Serial.println( "SENDING:" );
//    Serial.println( sendString );
    currentTick = 0; // reset the tick counter

    softSerial.println( sendString );
  }
  
//  Serial.println( "Connected to WiFi: " + hardSSID );
  delay( 100 );
}


/**
 * Provide the HTML form and content for connecting to a WiFi network
 * 
 * @return const String
 * @author costmo
 */
const String connectionHtml()
{
  String returnValue =
    commonHeader() +
    "<div id='container'>"
      "<div id='header'>"
        "<h3>Connect to your WiFi network</h3>"
      "</div>"
      "<div id='content'>"
        "<p>To get <strong>printerX</strong> connected to your WiFi network,<br/>please provide your credentials below.</p>"
        "<p>"
        "<FORM action='/connect' method='post'>"
          "<p><INPUT type='text' name='ssid' placeholder='SSID' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false'></p>"
          "<p><INPUT type='password' name='password' placeholder='Password' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false'></p>"
          "<p><INPUT type='submit' value='CONNECT'></p>"
        "</FORM action='/connect' method='post'>"
        "</p>"
        "<div id='exit_text'>"
           "<div id='question' onClick='showAnswer();return false;'>What is this?</div>"
           "<div id='answer'>"
            "<p>"
              "A Wireless Access Point (WAP) powers on with the <strong>printerX</strong> web server. "
              "While it is running, it enables you to reconfigure the web server's access to your wireless network by providing credentials in the boxes above. "
              "After providing an SSID and (optional) password, click 'CONNECT' and your web server's WiFi access credentials will be updated, the web server will reboot, and the <strong>printerX</strong> web server should become available at <a href='http://printerx.local'>http://printerX.local</a> after about 30 seconds. "
            "</p>"
            "<p>"
              "For security purposes, this WAP will only remain active for 10 minutes. If you wish to shut down the WAP right now, <a href='/shutdown'>click here</a>."
            "</p>"
          "</div>"
        "</div>"
      "</div>" +
      commonFooter();

  return returnValue;
}
